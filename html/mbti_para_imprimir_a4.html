<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MBTI - Imprimir A4 (3 columnas x 9 filas)</title>
    <style>
        /* Página A4 y margen superior amplio para evitar recortes */
        @page { size: A4; margin: 30mm 12mm 12mm 12mm; }
        @media print {
            html, body { height: auto; }
            body { margin: 0; }
            .page { page-break-after: always; }
            /* Ocultar controles y formulario global en la versión impresa/PDF */
            .global-header, .controls { display: none !important; }
        }

        body { font-family: Arial,Helvetica,sans-serif; background: #f2f2f2; color:#222; padding: 10px; }
        .wrapper { width: 100%; max-width: 210mm; margin: 0 auto; }
        header { text-align:center; margin-bottom: 8mm; }
        header h1 { margin:0 0 24px 0; font-size:18pt; color:#2a7a2a; }
        .global-header { margin-top:24px; display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap; }

        /* Cada página imprimible */
        .page { background: white; box-sizing: border-box; padding: 8mm 10mm 10mm 10mm; margin-bottom: 8mm; border: 1px solid transparent; }
        /* Top-safe: espacio extra por si el motor recorta la parte superior */
        .page::before { content: ''; display:block; height: 6mm; }

        /* Encabezado imprimible por hoja (líneas para completar a mano) */
        /* VERSIÓN: Oculto en pantalla y mostrado solo al imprimir (como en la primera versión) */
        .sheet-header-print { display:none !important; gap:8px; align-items:center; margin-bottom:6px; font-size:10pt; flex-wrap:wrap; }
        .sheet-header-print .print-line { display:inline-block; min-width:220px; border-bottom:1px solid #000; padding-bottom:3px; color: #000; }
        .sheet-header-print .print-field { min-width:220px; display:inline-block; }
        .sheet-header-print .print-label { margin-right:6px; color:#222; font-weight:500; }
        .sheet-header-print .print-field-small { min-width:90px; }
        @media screen {
            .sheet-header-print .print-line { border-bottom:1px dashed #bbb; color:#333; }
        }
        @media print {
            /* Mostrar encabezado por hoja solamente al imprimir */
            .sheet-header-print { display:flex !important; }
            /* Numeración de hoja (visible en impresión) */
            .sheet-page-number { font-weight:600; font-size:10pt; margin-left:12px; color:#222; white-space:nowrap; }
        }

        /* Cuadrícula: 3 columnas, 9 filas (27 items por página)*/
        .page-grid { display: grid; grid-template-columns: repeat(3, 1fr); grid-auto-rows: minmax(34px, auto); gap: 8px; grid-auto-flow: row; }

        /* Cada pregunta ocupa una celda. Evitar cortes dentro del elemento */
        .pregunta { border: 1px solid #cfe9cf; background:#f9fff9; padding:6px 8px; border-radius:4px; break-inside: avoid; -webkit-column-break-inside: avoid; }
        .pregunta h2 { margin:0 0 6px 0; font-size:10.5pt; color:#1f5d1f; font-weight:600; }
        /* Opciones: organizar en tres filas para alinear radios / números / leyendas */
        .opciones { display:block; font-size:9pt; }
        .opciones .op-row { display:grid; grid-template-columns: repeat(5, minmax(36px, 1fr)); gap:8px; align-items:center; text-align:center; margin:4px 0; }
        .opciones .op-row.radios input { transform: scale(1.05); margin:6px 0; }
        .opciones .op-row.numeros { font-size:9pt; color:#111; }
        .opciones .op-row.leyendas { font-size:8pt; color:#333; }
        /* Mantener compatibilidad con impresión: todo se imprime igual */

        /* Controles */
        .controls { margin:10px 0; text-align:center; }
        .controls button { padding:10px 16px; background:#2a7a2a; color:white; border:none; border-radius:6px; cursor:pointer; }
        .controls button:hover { background:#245f24; }

        /* Visualización en pantalla: limitar páginas para no llenar demasiado */
        @media screen {
            .page { box-shadow:0 6px 24px rgba(0,0,0,0.08); margin-bottom:18px; }
        }

        /* Asegurar que el grid respete el flujo por filas (left->center->right) */
        .page-grid { grid-auto-flow: row; }
    </style>
</head>
<body>
    <div class="wrapper">
        <header>
            <h1>Cuestionario - Versión Imprimible A4</h1>
            
            <div class="global-header" style="margin-top:6px; display:flex; gap:8px; justify-content:center; align-items:center; flex-wrap:wrap;">
                <label>Nombre: <input id="globalNombre" type="text" style="width:320px;"></label>
                <label>Cédula: <input id="globalCedula" type="text" style="width:120px;"></label>
                <label>Fecha: <input id="globalFecha" type="date" style="width:150px;"></label>
                <label style="font-size:0.9em;"><input type="checkbox" id="copyAll" checked> Copiar a todas las hojas</label>
            </div>
        </header>

        <div class="controls">
            <label style="font-size:0.9em; color:#333; margin-right:12px;">Preguntas por página: <strong id="perPageLabel">27</strong></label>
            <button id="btnImprimir">Imprimir / Generar PDF</button>
        </div>

        <div id="pagesContainer"></div>
    </div>

<script>
    // Cargar las preguntas desde el archivo principal (copiadas aquí para independencia)
    const grupo1_EI = [
        { texto: "Me siento lleno de energía después de socializar.", grupo: 1 },
        { texto: "Prefiero participar activamente en conversaciones de grupo.", grupo: 1 },
        { texto: "Me resulta fácil iniciar una conversación con desconocidos.", grupo: 1 },
        { texto: "A menudo busco la compañía de otros.", grupo: 1 },
        { texto: "Me gustan los ambientes ruidosos y concurridos.", grupo: 1 },
        { texto: "Soy más propenso a hablar que a escuchar.", grupo: 1 },
        { texto: "Disfruto expresando mis ideas abiertamente en público.", grupo: 1 },
        { texto: "Me considero una persona sociable y animada.", grupo: 1 },
        { texto: "Necesito mucha interacción social para sentirme bien.", grupo: 1 },
        { texto: "El aislamiento social me cansa rápidamente.", grupo: 1 },
        { texto: "Me adapto fácilmente a nuevos grupos sociales.", grupo: 1 },
        { texto: "Mis amigos me consideran extrovertido.", grupo: 1 },
        { texto: "Tomo la iniciativa en actividades sociales.", grupo: 1 },
        { texto: "Prefiero hacer cosas con mucha gente.", grupo: 1 },
        { texto: "Me gusta ser el centro de atención.", grupo: 1 },
        { texto: "Soy muy accesible para la mayoría de la gente.", grupo: 1 },
        { texto: "Me gusta debatir temas complejos en voz alta.", grupo: 1 },
        { texto: "Las reuniones grandes me resultan energizantes.", grupo: 1 },
        { texto: "Me aburro si estoy solo por mucho tiempo.", grupo: 1 },
        { texto: "Me expreso con facilidad y entusiasmo.", grupo: 1 },
        { texto: "Suelo actuar antes de pensar demasiado.", grupo: 1 },
        { texto: "Soy impulsivo y me gusta la espontaneidad social.", grupo: 1 },
        { texto: "La rutina me agobia; prefiero la novedad y la acción.", grupo: 1 },
        { texto: "Tengo un círculo amplio de conocidos.", grupo: 1 },
        { texto: "Siempre tengo algo que decir.", grupo: 1 }
    ];

    const grupo2_SN = [
        { texto: "Me concentro en los hechos y detalles tal como son.", grupo: 2 },
        { texto: "Confío en la experiencia y los datos verificables.", grupo: 2 },
        { texto: "Me preocupo más por el presente que por las posibilidades futuras.", grupo: 2 },
        { texto: "Soy práctico y me gusta lo concreto.", grupo: 2 },
        { texto: "Prefiero instrucciones claras y directas, paso a paso.", grupo: 2 },
        { texto: "Mi memoria para los detalles es excelente.", grupo: 2 },
        { texto: "Valoro el sentido común y la realidad inmediata.", grupo: 2 },
        { texto: "Busco soluciones que ya han sido probadas.", grupo: 2 },
        { texto: "Me gusta usar métodos y herramientas establecidos.", grupo: 2 },
        { texto: "Disfruto trabajando con datos tangibles.", grupo: 2 },
        { texto: "Encuentro que los temas abstractos son irrelevantes.", grupo: 2 },
        { texto: "Soy observador de lo que sucede a mi alrededor.", grupo: 2 },
        { texto: "Soy muy minucioso en mis tareas.", grupo: 2 },
        { texto: "Me baso en mis cinco sentidos para tomar decisiones.", grupo: 2 },
        { texto: "Prefiero mantener los pies en la tierra.", grupo: 2 },
        { texto: "Las metáforas y analogías me confunden.", grupo: 2 },
        { texto: "Me gusta ver el panorama completo antes de empezar.", grupo: 2 },
        { texto: "Soy bueno siguiendo un plan de trabajo detallado.", grupo: 2 },
        { texto: "Las teorías no me interesan mucho, a menos que sean aplicables.", grupo: 2 },
        { texto: "Tiendo a ser realista sobre mis expectativas.", grupo: 2 },
        { texto: "Recuerdo mejor los procedimientos que las ideas.", grupo: 2 },
        { texto: "Me molesta cuando la gente se va por las ramas.", grupo: 2 },
        { texto: "Tomo las cosas de forma literal.", grupo: 2 },
        { texto: "Busco la certeza en la información.", grupo: 2 },
        { texto: "Me enfoco en un problema a la vez, con atención.", grupo: 2 }
    ];

    const grupo3_TF = [
        { texto: "La lógica y la razón siempre deben guiar mis decisiones.", grupo: 3 },
        { texto: "Me considero una persona objetiva y crítica.", grupo: 3 },
        { texto: "Busco la justicia y la equidad por encima de la armonía grupal.", grupo: 3 },
        { texto: "Prefiero ser honesto aunque hiera sentimientos.", grupo: 3 },
        { texto: "Mi fortaleza reside en el análisis imparcial de los problemas.", grupo: 3 },
        { texto: "Al decidir, me baso en principios y reglas.", grupo: 3 },
        { texto: "Me resulta fácil ver los errores o fallos en un argumento.", grupo: 3 },
        { texto: "Me concentro en la verdad, sin dejarme llevar por la compasión.", grupo: 3 },
        { texto: "Las críticas no suelen afectarme personalmente.", grupo: 3 },
        { texto: "Suelo ser más reservado con mis emociones.", grupo: 3 },
        { texto: "Busco soluciones que sean técnicamente sólidas y eficientes.", grupo: 3 },
        { texto: "Creo que el respeto se gana con competencia.", grupo: 3 },
        { texto: "La eficiencia es crucial en mi trabajo.", grupo: 3 },
        { texto: "Me siento más cómodo debatiendo que consolando.", grupo: 3 },
        { texto: "Pienso que los sentimientos entorpecen las decisiones.", grupo: 3 },
        { texto: "Mantengo la calma en situaciones de conflicto.", grupo: 3 },
        { texto: "Es más importante la verdad que la diplomacia.", grupo: 3 },
        { texto: "Soy capaz de ser duro si la situación lo requiere.", grupo: 3 },
        { texto: "Mis críticas son directas y al grano.", grupo: 3 },
        { texto: "Me enorgullece mi capacidad de razonamiento frío.", grupo: 3 },
        { texto: "Trato a todos de la misma manera, aplicando reglas.", grupo: 3 },
        { texto: "Me es difícil entender reacciones emocionales exageradas.", grupo: 3 },
        { texto: "Soy mejor para solucionar problemas que para mediar.", grupo: 3 },
        { texto: "Me mantengo distante de los conflictos personales.", grupo: 3 },
        { texto: "La lógica es la herramienta más valiosa.", grupo: 3 }
    ];

    const grupo4_JP = [
        { texto: "Soy una persona organizada y planifico mi trabajo con antelación.", grupo: 4 },
        { texto: "Prefiero tener las cosas resueltas y cerradas cuanto antes.", grupo: 4 },
        { texto: "Me gusta seguir un horario y una lista de tareas.", grupo: 4 },
        { texto: "Trabajo mejor cuando tengo fechas límite claras.", grupo: 4 },
        { texto: "No me gusta dejar las decisiones para última hora.", grupo: 4 },
        { texto: "Disfruto terminando proyectos y pasando al siguiente.", grupo: 4 },
        { texto: "Me siento incómodo con los cambios de último momento.", grupo: 4 },
        { texto: "Tengo un plan para casi todo.", grupo: 4 },
        { texto: "Mis espacios de trabajo suelen estar ordenados y limpios.", grupo: 4 },
        { texto: "Busco la estructura, el orden y la previsibilidad.", grupo: 4 },
        { texto: "Creo en hacer el trabajo antes que el ocio (trabajo primero, juego después).", grupo: 4 },
        { texto: "Soy puntual y valoro la puntualidad de los demás.", grupo: 4 },
        { texto: "Cuando viajo, sigo un itinerario detallado.", grupo: 4 },
        { texto: "Me siento mejor una vez que he tomado una decisión final.", grupo: 4 },
        { texto: "Me gusta tener las cosas bajo control.", grupo: 4 },
        { texto: "La improvisación me estresa.", grupo: 4 },
        { texto: "Considero que la planificación es clave para el éxito.", grupo: 4 },
        { texto: "Soy muy responsable con mis compromisos.", grupo: 4 },
        { texto: "Me molesta la ineficiencia y la desorganización.", grupo: 4 },
        { texto: "Prefiero la anticipación a la sorpresa.", grupo: 4 },
        { texto: "Mis metas están definidas y son claras.", grupo: 4 },
        { texto: "Suelo empezar a trabajar mucho antes de la fecha límite.", grupo: 4 },
        { texto: "La ambigüedad me resulta frustrante.", grupo: 4 },
        { texto: "Me siento satisfecho cuando mi entorno está en orden.", grupo: 4 },
        { texto: "Tengo un sistema para organizar mis cosas.", grupo: 4 }
    ];

    const preguntas = [...grupo1_EI, ...grupo2_SN, ...grupo3_TF, ...grupo4_JP];

    // RENDER: paginar en bloques de 27 (3x9) y respetar orden por filas (left->center->right)
    const perPage = 27;
    const pagesContainer = document.getElementById('pagesContainer');

    function escapeHtmlAttr(s){ return String(s).replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    function buildPages() {
        pagesContainer.innerHTML = '';
        const copyAll = document.getElementById('copyAll')?.checked;
        const globalNombre = document.getElementById('globalNombre')?.value || '';
        const globalCedula = document.getElementById('globalCedula')?.value || '';
        const globalFecha = document.getElementById('globalFecha')?.value || '';
        const totalPages = Math.ceil(preguntas.length / perPage); // Total de hojas (para numeración) 

        for (let i = 0, pageIdx = 0; i < preguntas.length; i += perPage, pageIdx++) {
            const page = document.createElement('div');
            page.className = 'page';

            // Cabecera por hoja (Nombre / Cédula / Fecha)
            const headerDiv = document.createElement('div');
            headerDiv.className = 'sheet-header-print';
            const nombreVal = (copyAll && globalNombre) ? escapeHtml(globalNombre) : '';
            const cedulaVal = (copyAll && globalCedula) ? escapeHtml(globalCedula) : '';
            const fechaVal = (copyAll && globalFecha) ? escapeHtml(globalFecha) : '';
            headerDiv.innerHTML = `
                <div class="sheet-header-print" style="display:flex; justify-content:space-between; align-items:center;">
                    <div style="display:flex; gap:12px; align-items:center;">
                        <div><span class="print-label">Nombre:</span> <span class="print-line print-field">${nombreVal || '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}</span></div>
                        <div><span class="print-label">Cédula:</span> <span class="print-line print-field-small">${cedulaVal || '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}</span></div>
                        <div><span class="print-label">Fecha:</span> <span class="print-line print-field-small">${fechaVal || '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'}</span></div>
                    </div>
                    <div class="sheet-page-number">Hoja ${pageIdx + 1}/${totalPages}</div>
                </div>
            `;
            page.appendChild(headerDiv);

            const grid = document.createElement('div');
            grid.className = 'page-grid';

            const slice = preguntas.slice(i, i + perPage);
            // Render en orden natural — con grid-auto-flow: row esto llenará fila por fila
            slice.forEach((p, idx) => {
                const q = document.createElement('div');
                q.className = 'pregunta';
                const numero = i + idx + 1;

                const radios = [`<label><input type="radio" name="pregunta${numero}" value="1"></label>`,
                                `<label><input type="radio" name="pregunta${numero}" value="2"></label>`,
                                `<label><input type="radio" name="pregunta${numero}" value="3"></label>`,
                                `<label><input type="radio" name="pregunta${numero}" value="4"></label>`,
                                `<label><input type="radio" name="pregunta${numero}" value="5"></label>`].join('');

                const numeros = ['1','2','3','4','5'].map(n => `<div>${n}</div>`).join('');

                const leyendas = [`(Muy en desacuerdo)`,``, `(Neutro)`, ``, `(Muy de acuerdo)`].map(t => `<div>${t}</div>`).join('');

                q.innerHTML = `<h2>${numero}. ${escapeHtml(p.texto)}</h2>` +
                              `<div class="opciones">` +
                                `<div class="op-row radios">${radios}</div>` +
                                `<div class="op-row numeros">${numeros}</div>` +
                                `<div class="op-row leyendas">${leyendas}</div>` +
                              `</div>`;
                grid.appendChild(q);
            });
            page.appendChild(grid);
            pagesContainer.appendChild(page);

        // Si seleccionaron copiar a todas, propagar valores
        propagateGlobalToPages();
    }

    function propagateGlobalToPages(){
        const copyAll = document.getElementById('copyAll')?.checked;
        const n = document.getElementById('globalNombre')?.value || '';
        const c = document.getElementById('globalCedula')?.value || '';
        const f = document.getElementById('globalFecha')?.value || '';
        if(!copyAll) return;
        document.querySelectorAll('.page').forEach(page=>{
            const sN = page.querySelector('.print-line.print-field'); if(sN) sN.innerHTML = n ? escapeHtml(n) : '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            const sC = page.querySelector('.print-line.print-field-small'); if(sC) sC.innerHTML = c ? escapeHtml(c) : '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
            const sF = page.querySelectorAll('.print-line.print-field-small')[1]; if(sF) sF.innerHTML = f ? escapeHtml(f) : '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
        });
    }

    function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    // Propagar valores globales cuando cambien
    ['globalNombre','globalCedula','globalFecha','copyAll'].forEach(id => {
        const el = document.getElementById(id);
        if(el) el.addEventListener('input', () => propagateGlobalToPages());
    });

    document.getElementById('btnImprimir').addEventListener('click', () => {
        // actualizar antes de imprimir
        buildPages();
        window.print();
    });

    // Volver a construir y propagar antes de imprimir por si cambia el layout
    window.addEventListener('beforeprint', () => { buildPages(); propagateGlobalToPages(); });

    // Inicializar
    buildPages();
</script>
</body>
</html>